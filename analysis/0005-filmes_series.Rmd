---
output:
  html_document: default
  pdf_document: default
---

## Pacotes e comandos

```{r}
library(tidyverse)
library(readxl)
```



## Filmes

Dataset movies
```{r}
movies <- read.csv("D:/archives/_SUPERIOR/USP/Esalq/Outros/data_analysis/data_analysis/datasets/movies.csv")
```


## Séries

Dataset tvshow
```{r}
tvshow <- read.csv("D:/archives/_SUPERIOR/USP/Esalq/Outros/data_analysis/data_analysis/datasets/tvshow.csv")
```



### Exploração

Visão estrutural filmes:
```{r}
glimpse(movies)
```


Visão estrutural séries:
```{r}
glimpse(tvshow)
```


### Manipulação

União das bases de dados:
```{r}
dataset <- movies %>% select(everything(), -(Directors:Runtime)) %>% 
                       bind_rows(tvshow) %>% 
                       select(!X)
```


Alteração dos tipos dos dados das variáveis IMDb e Rotten Tomatoes:
```{r}
aj_imdb <- as.numeric(str_sub(dataset$IMDb, 1, 3))
aj_rotten <- str_sub(dataset$Rotten.Tomatoes, 1, 3)
aj_rotten <- gsub("/", "", aj_rotten)
aj_rotten <- as.numeric(aj_rotten)
```


Aplicação das alterações:
```{r}
dataset <- dataset %>%  mutate(IMDB = aj_imdb,
                                 ROTTEN = aj_rotten)
```




### Resumo estatístico

Resumo descritivo aplicado às médias das notas do percentil 95:
```{r}
dataset %>% mutate(Type = replace(Type, Type==1, "serie"), 
                    Type = replace(Type, Type==0, "filme"))  %>%
  group_by(Type) %>%
  summarise(media_IMDB=mean(IMDB, na.rm=T),
            media_ROTTEN=mean(ROTTEN, na.rm=T),
            p95_IMDB=quantile(IMDB, probs=0.95, type=5, na.rm=T),
            p95_ROTTEN=quantile(ROTTEN, probs=0.95, type=5, na.rm=T)) %>%
  ungroup() %>% droplevels(.)
```



### Resultados

Seleção dos melhores filmes
```{r}
best_movies <- dataset %>% filter(Type==0) %>% 
  mutate(melhores_IMDb = cut(IMDB, 
                            c(-Inf,
                              quantile(IMDB, probs=0.95, type=5, na.rm=T),
                              Inf),
                            c(0,1)),
         melhores_ROTTEN = cut(ROTTEN,
                              c(-Inf,
                                quantile(ROTTEN, probs=0.95, type=5, na.rm=T),
                                Inf),
                              c(0,1))) %>% 
  filter(melhores_IMDb==1&melhores_ROTTEN==1)
```


Seleção das melhores séries
```{r}
best_tvshow <- dataset %>% filter(Type==1) %>% 
  mutate(melhores_IMDb = cut(IMDB, 
                                 c(-Inf,
                                 quantile(IMDB, probs=0.95, type=5, na.rm=T),
                                 Inf),
                                 c(0,1)),
         melhores_ROTTEN = cut(ROTTEN,
                                 c(-Inf,
                                 quantile(ROTTEN, probs=0.95, type=5, na.rm=T),
                                 Inf),
                                 c(0,1))) %>% 
  filter(melhores_IMDb==1&melhores_ROTTEN==1)
```



### Visualização

10 Melhores Filmes
```{r}
head(best_movies, 10)
```


10 Melhores Séries
```{r}
head(best_tvshow, 10)
```

